# Настройка Discord OAuth авторизации

## Шаги для настройки

### 1. Выполнить SQL миграцию

Выполните SQL скрипт `dashboard/setup_discord_auth.sql` в Supabase SQL Editor для добавления полей Discord в таблицу `users`.

### 2. Настроить переменные окружения

Убедитесь, что в `.env` файле (или переменных окружения) настроены:

```env
DISCORD_CLIENT_ID=1417959083704582224
DISCORD_CLIENT_SECRET=PkdDkT3vTGcelzMfzXSisYOshvZYEi-y
DISCORD_REDIRECT_URI=https://bublickrust.ru/signin-discord
```

### 3. Перезапустить сервер

После выполнения SQL миграции и проверки переменных окружения, перезапустите сервер.

## Как это работает

1. Пользователь нажимает "Войти через Discord" на странице заявки на турнир
2. Перенаправление на Discord OAuth страницу
3. После авторизации Discord перенаправляет на `/signin-discord` с кодом
4. Сервер обменивает код на access token
5. Получает данные пользователя из Discord API
6. Проверяет существование пользователя по Discord ID в базе данных
7. Если пользователь не найден - создает нового пользователя
8. Создает сессию и возвращает токен
9. Токен сохраняется в localStorage и пользователь авторизован

## Важно

- Если пользователь не найден в базе данных, система автоматически создаст его при первом входе через Discord
- Все пользователи, авторизованные через Discord, имеют роль `user` по умолчанию
- Discord ID сохраняется в поле `discord_id` для дальнейшей идентификации

