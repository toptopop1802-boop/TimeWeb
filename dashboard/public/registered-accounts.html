<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Зарегистрированные Cursor аккаунты</title>
    <link rel="stylesheet" href="/public/style.css" />
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0b0b0b; color: #eaeaea; }
        .container { max-width: 1100px; margin: 24px auto; padding: 0 16px; }
        h1 { font-size: 22px; margin: 0 0 12px 0; }
        .cards { display: grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap: 12px; margin-bottom: 16px; }
        .card { background: #131313; border: 1px solid #222; border-radius: 10px; padding: 12px; }
        .card h3 { margin: 0 0 6px 0; font-size: 13px; color: #aaa; font-weight: 600; }
        .card .value { font-size: 18px; font-weight: 700; color: #fff; }
        .actions { display: flex; gap: 8px; margin: 10px 0 16px; }
        button, .btn { background: #ffffff; color: #0b0b0b; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .btn.secondary { background: #222; color: #fff; border: 1px solid #333; }
        .table { width: 100%; border-collapse: collapse; background: #0f0f0f; border: 1px solid #1f1f1f; border-radius: 10px; overflow: hidden; }
        .table th, .table td { padding: 10px 12px; border-bottom: 1px solid #1f1f1f; font-size: 13px; }
        .table th { text-align: left; color: #aaa; background: #101010; }
        .muted { color: #9aa0a6; font-size: 12px; }
        .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
        .right { text-align: right; }
        .empty { padding: 14px; color: #9aa0a6; }
        .pill { display: inline-block; padding: 2px 8px; border-radius: 999px; border: 1px solid #333; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Зарегистрированные Cursor аккаунты</h1>
        <div class="cards">
            <div class="card">
                <h3>Всего аккаунтов</h3>
                <div class="value" id="totalCount">—</div>
            </div>
        </div>
        <div class="actions">
            <a class="btn secondary" href="/public/stripe-accounts.html">← К списку исходных аккаунтов</a>
            <button id="refreshBtn">Обновить</button>
        </div>

        <table class="table">
            <thead>
                <tr>
                    <th style="width: 34px;">#</th>
                    <th>Email</th>
                    <th>Пароль</th>
                    <th>Зарегистрирован</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <tr><td class="empty" colspan="4">Загрузка...</td></tr>
            </tbody>
        </table>
        <div class="muted" style="margin-top: 10px;">
            Страница для просмотра успешно созданных аккаунтов (после ввода OTP). Данные отправляет расширение.
        </div>
    </div>

    <script>
        const API_BASE = location.origin;

        function fmtDate(iso) {
            try {
                const d = new Date(iso);
                const dd = String(d.getDate()).padStart(2, '0');
                const mm = String(d.getMonth() + 1).padStart(2, '0');
                const hh = String(d.getHours()).padStart(2, '0');
                const mi = String(d.getMinutes()).padStart(2, '0');
                const yyyy = d.getFullYear();
                return `${dd}.${mm}.${yyyy}, ${hh}:${mi}`;
            } catch {
                return iso || '—';
            }
        }

        async function loadStats() {
            const res = await fetch(`${API_BASE}/api/registered-accounts/stats`);
            if (res.ok) {
                const { total } = await res.json();
                document.getElementById('totalCount').textContent = total;
            }
        }

        async function loadList() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = `<tr><td class="empty" colspan="4">Загрузка...</td></tr>`;
            try {
                const res = await fetch(`${API_BASE}/api/registered-accounts`);
                if (!res.ok) throw new Error('Failed to load');
                const items = await res.json();

                if (!items || items.length === 0) {
                    tbody.innerHTML = `<tr><td class="empty" colspan="4">Пока нет записей</td></tr>`;
                    return;
                }

                tbody.innerHTML = '';
                items.forEach((it, idx) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${idx + 1}</td>
                        <td class="mono">${it.email}</td>
                        <td class="mono">${it.password}</td>
                        <td>${fmtDate(it.registered_at)}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (e) {
                tbody.innerHTML = `<tr><td class="empty" colspan="4">Ошибка загрузки</td></tr>`;
                console.error(e);
            }
        }

        document.getElementById('refreshBtn').addEventListener('click', () => {
            loadStats();
            loadList();
        });

        // Первичная загрузка
        loadStats();
        loadList();
    </script>
</body>
</html>


