#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ .env —Ñ–∞–π–ª–∞ –Ω–∞ Linux —Å–µ—Ä–≤–µ—Ä–µ

echo "=================================="
echo "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env –¥–ª—è dashboard"
echo "=================================="
echo ""

# –ü—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–∫—Ä–∏–ø—Ç–∞
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ENV_FILE="$SCRIPT_DIR/.env"
TEMPLATE_FILE="$SCRIPT_DIR/env-template.txt"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —à–∞–±–ª–æ–Ω–∞
if [ ! -f "$TEMPLATE_FILE" ]; then
    echo "‚ùå –§–∞–π–ª env-template.txt –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    exit 1
fi

# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π .env –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
if [ -f "$ENV_FILE" ]; then
    echo "üóëÔ∏è  –£–¥–∞–ª—è—é —Å—Ç–∞—Ä—ã–π .env —Ñ–∞–π–ª..."
    rm -f "$ENV_FILE"
fi

# –ö–æ–ø–∏—Ä—É–µ–º —à–∞–±–ª–æ–Ω –≤ .env
echo "‚úÖ –°–æ–∑–¥–∞—é –Ω–æ–≤—ã–π .env —Ñ–∞–π–ª –∏–∑ —à–∞–±–ª–æ–Ω–∞..."
cp "$TEMPLATE_FILE" "$ENV_FILE"

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ (—Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å)
chmod 600 "$ENV_FILE"

echo ""
echo "‚úÖ –§–∞–π–ª .env —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!"
echo ""
echo "üìã –°–æ–¥–µ—Ä–∂–∏–º–æ–µ .env:"
echo "=================================="
cat "$ENV_FILE"
echo "=================================="
echo ""
echo "‚ö†Ô∏è  –í–ê–ñ–ù–û: –ù–µ –∑–∞–±—É–¥—å—Ç–µ:"
echo "   1. –ó–∞–ø–æ–ª–Ω–∏—Ç—å SUPABASE_KEY (Service Role Key)"
echo "   2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å DISCORD_BOT_TOKEN"
echo "   3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤ Discord Portal –¥–æ–±–∞–≤–ª–µ–Ω redirect:"
echo "      https://bublickrust.ru/signin-discord"
echo ""
echo "–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–µ—Ä–≤–µ—Ä."

